{
	"info": {
		"_postman_id": "ega-bank-api-collection",
		"name": "EGA Bank API",
		"description": "Collection Postman pour tester toutes les APIs du système bancaire EGA",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080/api"
		},
		{
			"key": "accessToken",
			"value": ""
		},
		/*{
			"key": "refreshToken",
			"value": ""
		},*/
		{
			"key": "clientId",
			"value": ""
		},
		{
			"key": "accountNumber",
			"value": ""
		},
		{
			"key": "accountNumber2",
			"value": ""
		}
	],
	"item": [
		{
			"name": "01. Authentification",
			"item": [
				{
					"name": "1.1 Inscription",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set('accessToken', jsonData.accessToken);",
									"pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
									"",
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has tokens', function () {",
									"    pm.expect(jsonData).to.have.property('accessToken');",
									"    pm.expect(jsonData).to.have.property('refreshToken');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"admin\",\n    \"email\": \"admin@egabank.com\",\n    \"password\": \"password123\"\n}"
						},
						"url": "{{baseUrl}}/auth/register"
					}
				},
				{
					"name": "1.2 Connexion",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set('accessToken', jsonData.accessToken);",
									"pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
									"",
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has tokens', function () {",
									"    pm.expect(jsonData).to.have.property('accessToken');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"admin\",\n    \"password\": \"password123\"\n}"
						},
						"url": "{{baseUrl}}/auth/login"
					}
				},
				{
					"name": "1.3 Rafraîchir Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/auth/refresh?refreshToken={{refreshToken}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"auth",
								"refresh"
							],
							"query": [
								{
									"key": "refreshToken",
									"value": "{{refreshToken}}"
								}
							]
						}
					}
				}
			]
		},
		{
			"name": "02. Clients",
			"item": [
				{
					"name": "2.1 Créer Client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set('clientId', jsonData.id);",
									"",
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Client created with correct name', function () {",
									"    pm.expect(jsonData.nom).to.eql('Dupont');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nom\": \"Dupont\",\n    \"prenom\": \"Jean\",\n    \"dateNaissance\": \"1990-05-15\",\n    \"sexe\": \"MASCULIN\",\n    \"adresse\": \"123 Rue de Lomé\",\n    \"telephone\": \"+22890123456\",\n    \"courriel\": \"jean.dupont@email.com\",\n    \"nationalite\": \"Togolaise\"\n}"
						},
						"url": "{{baseUrl}}/clients"
					}
				},
				{
					"name": "2.2 Liste Clients",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has content array', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('content');",
									"    pm.expect(jsonData.content).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/clients?page=0&size=10",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"clients"
							],
							"query": [
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "10"
								}
							]
						}
					}
				},
				{
					"name": "2.3 Détail Client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": "{{baseUrl}}/clients/{{clientId}}"
					}
				},
				{
					"name": "2.4 Modifier Client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nom\": \"Dupont\",\n    \"prenom\": \"Jean-Pierre\",\n    \"dateNaissance\": \"1990-05-15\",\n    \"sexe\": \"MASCULIN\",\n    \"adresse\": \"456 Avenue Principale\",\n    \"telephone\": \"+22890123456\",\n    \"courriel\": \"jean.dupont@email.com\",\n    \"nationalite\": \"Togolaise\"\n}"
						},
						"url": "{{baseUrl}}/clients/{{clientId}}"
					}
				}
			]
		},
		{
			"name": "03. Comptes",
			"item": [
				{
					"name": "3.1 Créer Compte Épargne",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set('accountNumber', jsonData.numeroCompte);",
									"",
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Account has IBAN', function () {",
									"    pm.expect(jsonData.numeroCompte).to.match(/^TG/);",
									"});",
									"",
									"pm.test('Initial balance is 0', function () {",
									"    pm.expect(jsonData.solde).to.eql(0);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"typeCompte\": \"EPARGNE\",\n    \"clientId\": {{clientId}}\n}"
						},
						"url": "{{baseUrl}}/accounts"
					}
				},
				{
					"name": "3.2 Créer Compte Courant",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set('accountNumber2', jsonData.numeroCompte);",
									"",
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Account type is COURANT', function () {",
									"    pm.expect(jsonData.typeCompte).to.eql('COURANT');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"typeCompte\": \"COURANT\",\n    \"clientId\": {{clientId}}\n}"
						},
						"url": "{{baseUrl}}/accounts"
					}
				},
				{
					"name": "3.3 Liste Comptes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": "{{baseUrl}}/accounts"
					}
				},
				{
					"name": "3.4 Comptes Client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": "{{baseUrl}}/accounts/client/{{clientId}}"
					}
				}
			]
		},
		{
			"name": "04. Opérations Bancaires",
			"item": [
				{
					"name": "4.1 Dépôt",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Transaction type is DEPOT', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.type).to.eql('DEPOT');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"montant\": 100000,\n    \"description\": \"Dépôt initial\"\n}"
						},
						"url": "{{baseUrl}}/transactions/{{accountNumber}}/deposit"
					}
				},
				{
					"name": "4.2 Retrait",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Transaction type is RETRAIT', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.type).to.eql('RETRAIT');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"montant\": 25000,\n    \"description\": \"Retrait ATM\"\n}"
						},
						"url": "{{baseUrl}}/transactions/{{accountNumber}}/withdraw"
					}
				},
				{
					"name": "4.3 Retrait Solde Insuffisant",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Error message about insufficient balance', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('insuffisant');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"montant\": 99999999,\n    \"description\": \"Test solde insuffisant\"\n}"
						},
						"url": "{{baseUrl}}/transactions/{{accountNumber}}/withdraw"
					}
				},
				{
					"name": "4.4 Historique Transactions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response is array', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/transactions/{{accountNumber}}/history?debut=2024-01-01&fin=2025-12-31",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"transactions",
								"{{accountNumber}}",
								"history"
							],
							"query": [
								{
									"key": "debut",
									"value": "2024-01-01"
								},
								{
									"key": "fin",
									"value": "2025-12-31"
								}
							]
						}
					}
				},
				{
					"name": "4.5 Virement",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Transaction type is VIREMENT_SORTANT', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.type).to.eql('VIREMENT_SORTANT');",
									"});",
									"",
									"pm.test('Destination account is set', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.compteDestination).to.not.be.null;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"compteSource\": \"{{accountNumber}}\",\n    \"compteDestination\": \"{{accountNumber2}}\",\n    \"montant\": 10000,\n    \"description\": \"Virement test entre comptes\"\n}"
						},
						"url": "{{baseUrl}}/transactions/transfer"
					}
				},
				{
					"name": "4.6 Virement Même Compte (Erreur)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Error message about same account', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('identiques');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"compteSource\": \"{{accountNumber}}\",\n    \"compteDestination\": \"{{accountNumber}}\",\n    \"montant\": 5000,\n    \"description\": \"Test transfert même compte\"\n}"
						},
						"url": "{{baseUrl}}/transactions/transfer"
					}
				}
			]
		},
		{
			"name": "05. Relevé de Compte",
			"item": [
				{
					"name": "5.1 Télécharger Relevé PDF",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Content-Type is PDF', function () {",
									"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/pdf');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/statements/{{accountNumber}}?debut=2024-01-01&fin=2025-12-31",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"statements",
								"{{accountNumber}}"
							],
							"query": [
								{
									"key": "debut",
									"value": "2024-01-01"
								},
								{
									"key": "fin",
									"value": "2025-12-31"
								}
							]
						}
					}
				}
			]
		},
		{
			"name": "06. Tests Validation",
			"item": [
				{
					"name": "6.1 Client Sans Nom",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Validation error for nom', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.validationErrors).to.have.property('nom');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"prenom\": \"Test\",\n    \"dateNaissance\": \"1990-01-01\",\n    \"sexe\": \"MASCULIN\"\n}"
						},
						"url": "{{baseUrl}}/clients"
					}
				},
				{
					"name": "6.2 Email Invalide",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nom\": \"Test\",\n    \"prenom\": \"User\",\n    \"dateNaissance\": \"1990-01-01\",\n    \"sexe\": \"MASCULIN\",\n    \"courriel\": \"invalid-email\"\n}"
						},
						"url": "{{baseUrl}}/clients"
					}
				},
				{
					"name": "6.3 Montant Négatif",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"montant\": -1000,\n    \"description\": \"Test négatif\"\n}"
						},
						"url": "{{baseUrl}}/transactions/{{accountNumber}}/deposit"
					}
				}
			]
		}
	]
}